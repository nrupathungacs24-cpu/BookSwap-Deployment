<app-header></app-header>
<div class="h-[calc(100vh-80px)] bg-gray-50 flex flex-col">
    <div
        class="max-w-4xl w-full mx-auto flex-1 flex flex-col bg-white shadow-xl overflow-hidden md:my-4 md:rounded-2xl border border-gray-100">

        <!-- Chat Header -->
        <div class="p-4 border-b border-gray-100 flex items-center justify-between bg-white z-10">
            <div class="flex items-center gap-3">
                <button routerLink="/chats" class="md:hidden p-2 hover:bg-gray-100 rounded-full">
                    <i class="fa-solid fa-arrow-left text-gray-500"></i>
                </button>
                <div class="relative">
                    <img [src]="chat?.otherParticipantAvatar || 'assets/default-avatar.png'"
                        class="w-10 h-10 rounded-full border border-gray-100 object-cover" />
                    <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 border-2 border-white rounded-full">
                    </div>
                </div>
                <div>
                    <h2 class="font-bold text-gray-900 leading-tight">{{ chat?.otherParticipantName || 'Loading...' }}
                    </h2>
                    <p class="text-[10px] text-[#0DBE5E] font-medium uppercase tracking-wider">Book: {{ chat?.bookTitle
                        }}</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="p-2 text-gray-400 hover:text-gray-900 transition-colors"><i
                        class="fa-solid fa-phone"></i></button>
                <button class="p-2 text-gray-400 hover:text-gray-900 transition-colors"><i
                        class="fa-solid fa-ellipsis-vertical"></i></button>
            </div>
        </div>

        <!-- Messages Area -->
        <div #scrollContainer class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50/30">
            <div *ngIf="isLoading" class="flex justify-center p-10">
                <i class="fa-solid fa-circle-notch fa-spin text-gray-300 fa-2xl"></i>
            </div>

            <div *ngIf="!isLoading && messages.length === 0"
                class="flex flex-col items-center justify-center h-full opacity-40 grayscale">
                <i class="fa-regular fa-paper-plane fa-3xl mb-4"></i>
                <p class="text-sm font-medium">Say hello to start the conversation!</p>
            </div>

            <div *ngFor="let msg of messages" [class.justify-end]="msg.senderId === currentUserUid" class="flex w-full">

                <div [class.bg-[#0DBE5E]]="msg.senderId === currentUserUid"
                    [class.text-white]="msg.senderId === currentUserUid"
                    [class.bg-white]="msg.senderId !== currentUserUid"
                    [class.text-gray-900]="msg.senderId !== currentUserUid"
                    [class.rounded-br-none]="msg.senderId === currentUserUid"
                    [class.rounded-bl-none]="msg.senderId !== currentUserUid"
                    class="max-w-[75%] px-4 py-2.5 rounded-2xl shadow-sm text-sm border border-gray-100">

                    <p class="leading-relaxed">{{ msg.text }}</p>
                    <p class="text-[9px] mt-1 opacity-70 text-right">
                        {{ msg.createdAt | date:'shortTime' }}
                    </p>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-white border-t border-gray-100">
            <form (submit)="sendMessage()"
                class="flex items-center gap-2 bg-gray-50 rounded-full px-4 py-1.5 border border-gray-200 focus-within:border-[#0DBE5E] focus-within:ring-1 focus-within:ring-[#0DBE5E] transition-all">
                <button type="button" class="text-gray-400 hover:text-gray-600 p-2"><i
                        class="fa-solid fa-plus"></i></button>
                <input type="text" [(ngModel)]="newMessage" name="message" placeholder="Type your message here..."
                    class="flex-1 bg-transparent border-none focus:ring-0 text-sm py-2" />
                <button type="submit" [disabled]="!newMessage.trim()"
                    class="bg-[#0DBE5E] text-white w-9 h-9 rounded-full flex items-center justify-center shadow-md hover:bg-[#099c4d] transition-all disabled:bg-gray-200 disabled:shadow-none">
                    <i class="fa-solid fa-paper-plane text-sm"></i>
                </button>
            </form>
        </div>
    </div>
</div>
<app-footer></app-footer>